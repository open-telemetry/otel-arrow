[package]
name = "otap-df-otap"
description = "OTAP nodes"
version.workspace = true
authors.workspace = true
repository.workspace = true
license.workspace = true
publish.workspace = true
edition.workspace = true
rust-version.workspace = true

[lints]
workspace = true

[dependencies]
arrow.workspace = true
arrow-ipc.workspace = true
async-trait.workspace = true
ciborium.workspace = true
futures.workspace = true
futures-timer.workspace = true
http.workspace = true
humantime-serde.workspace = true
log.workspace = true
object_store = {workspace = true, features = ["fs"]}
parquet.workspace = true
thiserror = { workspace = true }
serde_json = { workspace = true }
slotmap = { workspace = true }
tokio = { workspace = true }
linkme = { workspace = true }
uuid.workspace = true
weaver_forge.workspace = true
weaver_common.workspace = true
tonic = { workspace = true }
tonic-middleware = { workspace = true }
tonic-prost = { workspace = true }
prost = { workspace = true }
smallvec = { workspace = true }
bitflags = { workspace = true }
bytes = { workspace = true }
parking_lot = { workspace = true }

data_engine_kql_parser = { workspace = true }
data_engine_expressions = { workspace =  true }
otap-df-engine = { path = "../engine" }
otap-df-engine-macros = { path = "../engine-macros" }
otap-df-channel = { path = "../channel" }
otap-df-config = { path = "../config" }
otap-df-pdata = { path = "../pdata" }
otap-df-query-engine = { path = "../query-engine" }
otap-df-telemetry = { path = "../telemetry" }
otap-df-telemetry-macros = { path = "../telemetry-macros" }

chrono.workspace = true
tower-service.workspace = true
fluke-hpack.workspace = true
serde.workspace = true
tokio-stream.workspace = true
async-stream.workspace = true
humantime.workspace = true
weaver_semconv.workspace = true
weaver_resolved_schema.workspace = true
weaver_resolver.workspace = true
rand.workspace = true
zip.workspace = true
tower = { workspace = true }

# Geneva exporter dependencies
geneva-uploader = { version = "0.3.0", optional = true }

# Azure Monitor Exporter dependencies
azure_identity = { workspace = true, optional = true }
flate2 = { workspace = true, optional = true }
reqwest = { workspace = true, optional = true, features = ["rustls-tls"] }
azure_core = { workspace = true, optional = true,  features = ["reqwest"] }
ahash = { workspace = true, optional = true }

# OpenTelemetry proto with tonic feature enabled
opentelemetry-proto = { workspace = true, optional = true }
rustls-native-certs = { workspace = true, optional = true }
base64 = { workspace = true, optional = true }
arc-swap = { workspace = true, optional = true }
rustls = { workspace = true, optional = true }
rustls-pki-types = { workspace = true, optional = true }
tokio-rustls = { workspace = true, optional = true }
notify = { workspace = true, optional = true }

[features]
experimental-tls = ["dep:rustls", "dep:rustls-pki-types", "dep:tokio-rustls", "dep:rustls-native-certs", "tonic/tls-ring", "dep:base64", "dep:arc-swap", "dep:notify"]
# Base experimental feature - enabled by all experimental exporters
experimental-exporters = []
# Experimental exporters
geneva-exporter = ["experimental-exporters", "dep:geneva-uploader", "dep:opentelemetry-proto"]
azure-monitor-exporter = [
    "experimental-exporters",
    "dep:opentelemetry-proto",
    "dep:azure_identity",
    "dep:flate2",
    "dep:reqwest",
    "dep:azure_core",
    "dep:ahash",
]
# Experimental processors
condense-attributes-processor = []
azure = ["object_store/azure", "object_store/cloud", "dep:azure_identity", "dep:azure_core"]


[dev-dependencies]
flume.workspace = true
portpicker.workspace = true
pretty_assertions.workspace = true
rcgen.workspace = true
tempfile.workspace = true
url.workspace = true
tokio-util.workspace = true
time.workspace = true
wiremock.workspace = true
rustls.workspace = true
tokio-rustls.workspace = true
rustls-pki-types.workspace = true
