# Geneva Exporter Test Configuration with OTLP Receiver
#
# This configuration sets up an OTLP gRPC receiver that accepts telemetry
# from instrumented applications and forwards it to Geneva.
#
# Usage:
#   ./df_engine --config otlp-geneva.yaml --num-cores 1
#
# Send data to this collector using:
#   - OTLP/gRPC endpoint: localhost:4317
#
# NOTE: Environment Variable Support
# -----------------------------------
# The current config system does NOT support environment variable substitution (e.g., ${ENV_VAR}).
# This is documented as a future enhancement in the config layer roadmap.
#
# Workarounds for sensitive data:
# 1. Use a template processor (envsubst, sed) before passing to df_engine:
#    envsubst < otlp-geneva.yaml | ./df_engine --config /dev/stdin
#
# 2. Generate the config file at deployment time with your CI/CD tooling
#
# 3. For Kubernetes: Use a ConfigMap with values injected from Secrets

version: otel_dataflow/v1

policies:
  channel_capacity:
    control:
      node: 100
      pipeline: 100
    pdata: 128

engine: {}

groups:
  default:
    pipelines:
      main:
        nodes:
          # OTLP gRPC Receiver - Accepts telemetry from instrumented apps
          otlp-receiver:
            type: "urn:otel:otlp:receiver"
            config:
              protocols:
                grpc:
                  # The address to listen on for gRPC connections
                  listening_addr: "127.0.0.1:4317"

          # Geneva exporter configuration
          geneva-exporter:
            type: "urn:otel:geneva:exporter"
            config:
              # ============================================================
              # REQUIRED FIELDS - Replace with your Geneva deployment values
              # ============================================================
              endpoint: "https://your-geneva-endpoint.com"
              environment: "test"
              account: "your-account-name"
              namespace: "your-namespace"
              region: "westus2"
              config_major_version: 1
              tenant: "your-tenant-name"
              role_name: "otlp-collector"
              role_instance: "collector-001"

              # ============================================================
              # AUTHENTICATION
              # ============================================================
              auth:
                type: "certificate"
                path: "/path/to/your/certificate.p12"
                password: "your-cert-password"

              # ============================================================
              # OPTIONAL SETTINGS
              # ============================================================
              # NOTE: max_buffer_size is currently reserved for a future buffering/flush
              # implementation in the exporter. It is accepted by config parsing but not
              # currently used to change runtime behavior.
              max_buffer_size: 1000
              max_concurrent_uploads: 4

        connections:
          - from: otlp-receiver
            to: geneva-exporter
