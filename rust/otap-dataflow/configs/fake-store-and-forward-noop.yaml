# Fake Data -> Store-and-Forward -> Noop pipeline for throughput testing
#
# This configuration uses the fake data generator to produce synthetic OTAP data,
# persists it through Quiver, and sends to noop exporter.
#
# Build with: cargo build --release --features persistence
# Run with:   ./target/release/df_engine --pipeline configs/fake-store-and-forward-noop.yaml

settings:
  default_pipeline_ctrl_msg_channel_size: 100
  default_node_ctrl_msg_channel_size: 100
  default_pdata_channel_size: 100

nodes:
  receiver:
    kind: receiver
    plugin_urn: "urn:otel:otap:fake_data_generator:receiver"
    out_ports:
      out_port:
        destinations:
          - store_and_forward
        dispatch_strategy: round_robin
    config:
      traffic_config:
        # Generate signals continuously (null = unlimited)
        max_signal_count: null
        # Batch size of 100 signals per message
        max_batch_size: 100
        # Rate: 10000 signals/sec for sustainable throughput testing
        signals_per_second: 10000
        # Only generate logs (100% weight to logs)
        log_weight: 100

  store_and_forward:
    kind: processor
    plugin_urn: "urn:otel:store_and_forward:processor"
    out_ports:
      out_port:
        destinations:
          - noop
        dispatch_strategy: round_robin
    config:
      # Store in a temp directory
      path: /tmp/quiver_perf_test
      poll_interval: 10ms
      retention_size_cap: "500MB"
      size_cap_policy: backpressure
      # Faster segment finalization for testing
      max_segment_open_duration: 500ms

  noop:
    kind: exporter
    plugin_urn: "urn:otel:noop:exporter"
    config:
