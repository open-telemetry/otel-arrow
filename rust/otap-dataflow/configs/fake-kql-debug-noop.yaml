settings:
  default_pipeline_ctrl_msg_channel_size: 100
  default_node_ctrl_msg_channel_size: 100
  default_pdata_channel_size: 100

nodes:
  receiver:
    kind: receiver
    plugin_urn: "urn:otel:otap:fake_data_generator:receiver"
    out_ports:
      out_port:
        destinations:
          - kql
        dispatch_strategy: round_robin
    config:
      traffic_config:
        max_signal_count: 100
        max_batch_size: 50
        signals_per_second: 10
        log_weight: 100
        metric_weight: 0
        trace_weight: 0
      registry_path: https://github.com/open-telemetry/semantic-conventions.git[model]
  
  kql:
    kind: processor
    plugin_urn: "urn:otel:kql:processor"
    out_ports:
      out_port:
        destinations:
          - debug
        dispatch_strategy: round_robin
    config:
      query: |
        source
        | extend Body = case(
            EventName == "payment.failed" or Body has "payment",
            strcat(Body, "\n\nTroubleshooting: https://docs.example.com/payment-errors\nSupport: https://support.example.com/ticket"),
            Body
        )
      diagnostic_level: "info"
  
  debug:
    kind: processor
    plugin_urn: "urn:otel:debug:processor"
    out_ports:
      out_port:
        destinations:
          - noop
        dispatch_strategy: round_robin
    config:
      verbosity: detailed
      mode: signal
  
  noop:
    kind: exporter
    plugin_urn: "urn:otel:noop:exporter"
    config:

service:
  telemetry:
    logs:
      level: "error"
      processors:
        - batch:
            exporter:
              console:
    resource:
      service.name: "kql-processor-demo"
