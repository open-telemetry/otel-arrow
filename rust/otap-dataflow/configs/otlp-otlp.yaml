# OTLP/gRPC receiver -> OTLP exporter pipeline (gRPC-only mode)
#
# This configuration demonstrates gRPC-only mode for the OTLP receiver.
# For HTTP-only, see otlp-http-otlp.yaml
# For both protocols enabled, see otlp-both-otlp.yaml

settings:
  default_pipeline_ctrl_msg_channel_size: 100
  default_node_ctrl_msg_channel_size: 100
  default_pdata_channel_size: 100

nodes:
  receiver:
    type: otlp:receiver
    config:
      protocols:
        # OTLP/gRPC receiver only (default port: 4317)
        grpc:
          listening_addr: "127.0.0.1:4317"

          # --- Request/Response behavior ---
          # wait_for_result: false        # Wait for downstream ACK before responding
          # timeout: "30s"                # Timeout for gRPC requests

          # --- Concurrency limits ---
          # max_concurrent_requests: 0    # 0 = auto (matches downstream capacity)

          # --- Compression ---
          # request_compression: [zstd, gzip, deflate]  # or "none" to disable
          # response_compression: []      # Empty = no response compression

          # --- TLS configuration ---
          # tls:
          #   cert_file: "/path/to/server.crt"
          #   key_file: "/path/to/server.key"
          #   client_ca_file: "/path/to/client-ca.crt"  # For mTLS
          #   include_system_ca_certs_pool: false
          #   handshake_timeout: "10s"
          #   reload_interval: "5m"

  exporter:
    type: otlp:exporter
    config:
      # Downstream OTLP/gRPC collector endpoint.
      # Uses a different port than this receiver to avoid accidental loops.
      grpc_endpoint: "http://127.0.0.1:4319"
      # timeout: "15s"  # Optional: timeout for RPC requests

      # TLS / mTLS (exporter-side)
      # - TLS is enabled when `grpc_endpoint` uses https:// (scheme default).
      # - Setting `tls` enables TLS/mTLS and provides additional configuration options.
      # - If `tls` is omitted and `grpc_endpoint` uses http://, the connection is plaintext.
      # grpc_endpoint: "https://collector.example.com:4317"
      # tls:
      #   # Trust settings for verifying the server certificate
      #   ca_file: "/path/to/ca.crt"          # or `ca_pem: | ...`
      #   include_system_ca_certs_pool: false # default is true
      #   server_name_override: "collector.example.com"  # SNI / verification name override
      #
      #   # Client identity for mTLS (optional)
      #   cert_file: "/path/to/client.crt"   # or `cert_pem: | ...`
      #   key_file: "/path/to/client.key"    # or `key_pem: | ...`

connections:
  - from: receiver
    to: exporter
